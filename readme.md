# CMIS Adapter – Spring Boot

## Contents

- [Overview](#overview)
- [Features](#features)
- [Configuration](#configuration)
- [Build & Run](#build--run)
- [REST Endpoints](#rest-endpoints)
- [Prometheus Monitoring](#prometheus-monitoring)
- [Logging](#logging)
- [Sample Configuration](#sample-configuration)
- [Known Issues](#known-issues)
- [Disclaimer](#disclaimer)
- [License](#license)

---

## Overview

The **CMIS Adapter** is a Spring Boot 3 application designed to forward CMIS 1.1/1.2 REST calls to different backend systems. Depending on the configuration, dynamic switching between multiple environments (e.g., *dev*, *prod*) is possible.  
The adapter is fully documented (OpenAPI/Swagger), logs all requests in detail, and provides Prometheus metrics for monitoring.

---

## Features

- Switchable environments via `application.yaml` (e.g., dev/prod)
- Two independent RestTemplates with custom timeouts
- Dynamic service selection via property
- Full logging support (`Slf4j`, Spring Logger)
- Complete OpenAPI/Swagger documentation
- Prometheus metrics for all endpoints and service calls
- Exception handling with API error model
- Sample implementations for Repository, Document, Folder, ACL, Policy, etc.
- "Use at your own risk" – no liability

---

## Configuration

All environment and target system settings are defined in `application.yaml`.  
Example (excerpt):

```yaml
cmis:
  adapter:
    stack: dev # or 'prod'
    environment_dev: "http://localhost:9010"
    environment_prod: "https://cmis.prod.system"
    timeout_dev: 5000
    timeout_prod: 2000
```

Switching is done via `cmis.adapter.stack`. RestTemplates are initialized with their respective timeouts.

---

## Build & Run

```bash
mvn clean install
java -jar target/cmis-adapter.jar
```

Swagger UI: [http://localhost:8080/swagger-ui.html](http://localhost:8080/swagger-ui.html)  
Prometheus Metrics: [http://localhost:8080/actuator/prometheus](http://localhost:8080/actuator/prometheus)

---

## REST Endpoints

**Sample Overview:**

| HTTP           | Path                         | Description                      |
|----------------|------------------------------|----------------------------------|
| GET            | `/api/repository`            | Retrieve repository information  |
| GET            | `/api/documents/{id}`        | Get document details             |
| POST           | `/api/documents`             | Create new document              |
| PUT            | `/api/documents/{id}`        | Update existing document         |
| DELETE         | `/api/documents/{id}`        | Delete document                  |
| GET            | `/api/folders/{id}`          | Retrieve folder details          |
| GET            | `/api/acl/{objectId}`        | Get ACL for a given object       |
| POST           | `/api/policy/apply`          | Apply policy to object           |

For the complete list of endpoints and descriptions, see Swagger UI at `/swagger-ui.html`.

---

## Prometheus Monitoring

All REST calls and service operations are exported as metrics.  
Example metrics:

- `cmis.repository.get.time`
- `cmis.document.create.time`
- `cmis.acl.get.time`
- ...

Access: `/actuator/prometheus`

---

## Logging

All access is logged in detail, including environment, userId (if available), payload, and response time.  
Log levels can be configured in `application.yaml`.

---

## Sample Configuration

```yaml
cmis:
  adapter:
    stack: dev
    environment_dev: "http://localhost:8081"
    environment_prod: "https://cmis.prod.system"
    timeout_dev: 5000
    timeout_prod: 2000

logging:
  level:
    ch.elbernito.cmis.adapter: DEBUG

management:
  endpoints:
    web:
      exposure:
        include: "*"
  metrics:
    export:
      prometheus:
        enabled: true
```

---

## Known Issues

- Conflicts may occur when operating multiple stacks in parallel.
- Prometheus metrics will only appear after real requests have been processed.
- `No qualifying bean` error: Check that `stack` is correctly set and both RestTemplates are defined.
- No official global timeout alternative for HttpClient5 in Spring RestTemplate – see Javadoc for context.

- it's not tested at this time!!!
---

## Disclaimer

> **Use at your own risk!**  
> This software is provided "as is" with no guarantees of any kind.  
> It is intended solely for testing and development purposes.  
> The author accepts no liability for any damages, data loss, or unintended effects.

---

## License

MIT License  
See `LICENSE.md` in the repository.

---

*README last updated: 2025-06-20 – generated by AI for [ch.elbernito.cmis.adapter](https://github.com/elbernito/cmis-adapter)*
